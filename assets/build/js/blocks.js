!function(){"use strict";var e={n:function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,{a:o}),o},d:function(t,o){for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.wp.element,o=window.wp.i18n,n=window.wp.blocks,l=window.wp.blockEditor,c=window.wp.components,r=window.React,a=window.wp.apiFetch,s=e.n(a);const u=()=>s()({path:"/unlock-protocol/v1/settings"}).then((e=>{let t=e.networks,n=[{label:(0,o.__)("None","unlock-protocol"),value:-1}];return Object.entries(t).forEach((e=>{let[t,o]=e;n.push({label:o.network_name.charAt(0).toUpperCase()+o.network_name.slice(1),value:o.network_id})})),n})).catch((e=>(console.error(e),[]))),i=e=>{let{onSaveNewLock:o,removeLock:n,locks:l}=e;const[a,s]=(0,r.useState)(!1);return(0,t.createElement)("div",null,(0,t.createElement)("ul",null,l.map(((e,o)=>(0,t.createElement)(d,{lock:e,onRemove:()=>{n(o)}})))),(0,t.createElement)(c.Button,{className:"components-button is-link",onClick:()=>s(!a)},"Add Lock"),a&&(0,t.createElement)(k,{handleSave:async e=>{await o(e),s(!1)}}))},k=e=>{let{handleSave:n}=e;const[l,a]=(0,r.useState)(),[s,i]=(0,r.useState)(),[k,d]=(0,r.useState)(""),[p,m]=(0,r.useState)([]);(0,r.useEffect)((()=>{u().then((e=>{m(e)}))}),[]);const w=e=>/^0x[a-fA-F0-9]{40}$/.test(e);return p?(0,t.createElement)("form",{onSubmit:e=>(e.preventDefault(),n({network:l,address:s}),!1)},(0,t.createElement)("div",{className:"add-lock-form"},(0,t.createElement)(c.SelectControl,{label:(0,o.__)("Network","unlock-protocol"),options:p,value:l,onChange:e=>a(parseInt(e))}),(0,t.createElement)("p",{className:"label"},(0,o.__)("Lock Address","unlock-protocol")),(0,t.createElement)(c.TextControl,{disabled:!l,value:s,onChange:e=>{w(e)?d(""):d((0,o.__)("Invalid Lock address","unlock-protocol")),i(e)}}),k&&(0,t.createElement)("p",{className:"lock-warning"},k),(0,t.createElement)(c.Button,{disabled:!l||!w(s),className:"add-lock",type:"submit"},(0,o.__)("Add New Lock","unlock-protocol")))):null},d=e=>{let{lock:o,onRemove:n}=e;const[l,a]=(0,r.useState)();return(0,r.useEffect)((()=>{u().then((e=>{e.forEach((e=>{let{value:t,label:n}=e;t===o.network&&a(`${n}: ${function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:18,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"...";if(e.length<=t)return e;o=o||"...";var n=t-o.length,l=Math.ceil(n/2),c=Math.floor(n/2);return e.substr(0,l)+o+e.substr(e.length-c)}(o.address)}`)}))}))}),[o.network]),(0,t.createElement)("li",{style:{display:"flex","justify-content":"space-between"}},(0,t.createElement)("span",null,l),(0,t.createElement)(c.Button,{isSmall:!0,isDestructive:!0,onClick:n},"remove"))},p=e=>-1===e.network||!!e.address&&!!new RegExp("^0x[a-fA-F0-9]{40}$","g").test(e.address);(0,n.registerBlockType)("unlock-protocol/unlock-box",{title:(0,o.__)("Unlock Protocol","unlock-protocol"),category:"common",icon:"lock",description:(0,o.__)("A block to add lock(s) to the content inside of WordPress. This lets you restrict access to some section in your post.","unlock-protocol"),attributes:{locks:{type:"array",default:[]},ethereumNetworks:{type:"array",default:[]}},supports:{align:!0},edit:function(e){let{attributes:r,setAttributes:a}=e;const{locks:s}=r,u=(0,n.getBlockTypes)().map((e=>e.name)).filter((e=>"unlock-protocol/unlock-box"!==e));return(0,t.createElement)("div",(0,l.useBlockProps)(),(0,t.createElement)(l.InspectorControls,null,(0,t.createElement)(c.PanelBody,{title:(0,o.__)("Locks","unlock-protocol")},(0,t.createElement)(i,{onSaveNewLock:e=>{a(s?{locks:[...s,e]}:{locks:[e]})},removeLock:e=>{const t=[...s];t.splice(e,1),a({locks:t})},locks:s}))),(0,t.createElement)("div",{className:"unlock-header-icon"}),(e=>{let t=!0;return 0===e.length&&(t=!1),e.forEach((e=>{-1!==e.network&&p(e)||(t=!1)})),t})(s)?(wp.data.dispatch("core/editor").unlockPostSaving("my-lock"),(0,t.createElement)(l.InnerBlocks,{allowedBlocks:u})):(wp.data.dispatch("core/editor").lockPostSaving("my-lock"),(0,t.createElement)("div",{className:"no-lock-address"},(0,t.createElement)("p",null,(0,o.__)("Please configure the lock(s) on this block.","unlock-protocol")))))},save:()=>(0,t.createElement)(l.InnerBlocks.Content,null)})}();